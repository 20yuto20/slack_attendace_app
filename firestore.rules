rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // attendance コレクションのルール
    match /attendance/{document} {
      // 認証されたユーザーのみ読み書き可能
      allow read, write: if request.auth != null;
      
      // 月次データ取得のための複数ドキュメント読み取り許可
      // start_timeに基づくクエリを許可
      allow list: if request.auth != null 
        && request.query.limit <= 1000  // 1000件までの制限
        && request.query.orderBy == "start_time";  // start_timeでの並び替えを許可
    }

    // デフォルトルール - 明示的に許可されていないアクセスを拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}